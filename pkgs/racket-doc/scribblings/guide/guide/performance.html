<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>19&nbsp;性能（Performance）</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Racket&#25351;&#21335;</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="intro.html" class="tocviewlink" data-pltdoc="x">Welcome to Racket</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="to-scheme.html" class="tocviewlink" data-pltdoc="x">Racket Essentials</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="datatypes.html" class="tocviewlink" data-pltdoc="x">Built-<wbr></wbr>In Datatypes</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="scheme-forms.html" class="tocviewlink" data-pltdoc="x">Expressions and Definitions</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="define-struct.html" class="tocviewlink" data-pltdoc="x">Programmer-<wbr></wbr>Defined Datatypes</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="modules.html" class="tocviewlink" data-pltdoc="x">Modules</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="contracts.html" class="tocviewlink" data-pltdoc="x">Contracts</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="i_o.html" class="tocviewlink" data-pltdoc="x">Input and Output</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="regexp.html" class="tocviewlink" data-pltdoc="x">Regular Expressions</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="control.html" class="tocviewlink" data-pltdoc="x">Exceptions and Control</a></td></tr><tr><td align="right">11&nbsp;</td><td><a href="for.html" class="tocviewlink" data-pltdoc="x">Iterations and Comprehensions</a></td></tr><tr><td align="right">12&nbsp;</td><td><a href="match.html" class="tocviewlink" data-pltdoc="x">Pattern Matching</a></td></tr><tr><td align="right">13&nbsp;</td><td><a href="classes.html" class="tocviewlink" data-pltdoc="x">Classes and Objects</a></td></tr><tr><td align="right">14&nbsp;</td><td><a href="units.html" class="tocviewlink" data-pltdoc="x">Units</a></td></tr><tr><td align="right">15&nbsp;</td><td><a href="reflection.html" class="tocviewlink" data-pltdoc="x">Reflection and Dynamic Evaluation</a></td></tr><tr><td align="right">16&nbsp;</td><td><a href="macros.html" class="tocviewlink" data-pltdoc="x">Macros</a></td></tr><tr><td align="right">17&nbsp;</td><td><a href="languages.html" class="tocviewlink" data-pltdoc="x">&#21019;&#36896;&#35821;&#35328;</a></td></tr><tr><td align="right">18&nbsp;</td><td><a href="concurrency.html" class="tocviewlink" data-pltdoc="x">&#24182;&#21457;&#19982;&#21516;&#27493;</a></td></tr><tr><td align="right">19&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">&#24615;&#33021;&#65288;Performance&#65289;</a></td></tr><tr><td align="right">20&nbsp;</td><td><a href="parallelism.html" class="tocviewlink" data-pltdoc="x">Parallelism</a></td></tr><tr><td align="right">21&nbsp;</td><td><a href="running.html" class="tocviewlink" data-pltdoc="x">Running and Creating Executables</a></td></tr><tr><td align="right">22&nbsp;</td><td><a href="More_Libraries.html" class="tocviewlink" data-pltdoc="x">More Libraries</a></td></tr><tr><td align="right">23&nbsp;</td><td><a href="dialects.html" class="tocviewlink" data-pltdoc="x">Dialects of Racket and Scheme</a></td></tr><tr><td align="right">24&nbsp;</td><td><a href="other-editors.html" class="tocviewlink" data-pltdoc="x">Command-<wbr></wbr>Line Tools and Your Editor of Choice</a></td></tr><tr><td align="right"></td><td><a href="doc-bibliography.html" class="tocviewlink" data-pltdoc="x">Bibliography</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" data-pltdoc="x">Index</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>19&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">&#24615;&#33021;&#65288;Performance&#65289;</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">19.1&nbsp;</td><td><a href="#%28part._.Dr.Racket-perf%29" class="tocviewlink" data-pltdoc="x">Dr<span class="mywbr"> &nbsp;</span>Racket&#20013;&#30340;&#24615;&#33021;</a></td></tr><tr><td align="right">19.2&nbsp;</td><td><a href="#%28part._.J.I.T%29" class="tocviewlink" data-pltdoc="x">&#23383;&#33410;&#30721;&#21644;&#21363;&#26102;&#65288;JIT&#65289;&#32534;&#35793;&#22120;</a></td></tr><tr><td align="right">19.3&nbsp;</td><td><a href="#%28part._modules-performance%29" class="tocviewlink" data-pltdoc="x">&#27169;&#22359;&#21644;&#24615;&#33021;</a></td></tr><tr><td align="right">19.4&nbsp;</td><td><a href="#%28part._func-call-performance%29" class="tocviewlink" data-pltdoc="x">&#20989;&#25968;&#35843;&#29992;&#20248;&#21270;</a></td></tr><tr><td align="right">19.5&nbsp;</td><td><a href="#%28part._~e7~aa~81~e5~8f~98~e5~92~8c~e6~80~a7~e8~83~bd%29" class="tocviewlink" data-pltdoc="x">&#31361;&#21464;&#21644;&#24615;&#33021;</a></td></tr><tr><td align="right">19.6&nbsp;</td><td><a href="#%28part._letrec-performance%29" class="tocviewlink" data-pltdoc="x"><span class="RktSym"><span class="badlink"><span class="RktValLink">letrec</span></span></span>&#24615;&#33021;</a></td></tr><tr><td align="right">19.7&nbsp;</td><td><a href="#%28part._fixnums%2Bflonums%29" class="tocviewlink" data-pltdoc="x">Fixnum&#21644;Flonum&#20248;&#21270;</a></td></tr><tr><td align="right">19.8&nbsp;</td><td><a href="#%28part._unchecked-unsafe%29" class="tocviewlink" data-pltdoc="x">&#26410;&#26816;&#26597;&#30340;&#12289;&#19981;&#23433;&#20840;&#30340;&#25805;&#20316;</a></td></tr><tr><td align="right">19.9&nbsp;</td><td><a href="#%28part._ffi-pointer-access%29" class="tocviewlink" data-pltdoc="x">&#22806;&#26469;&#30340;&#25351;&#38024;</a></td></tr><tr><td align="right">19.10&nbsp;</td><td><a href="#%28part._regexp-perf%29" class="tocviewlink" data-pltdoc="x">&#27491;&#21017;&#34920;&#36798;&#24335;&#24615;&#33021;</a></td></tr><tr><td align="right">19.11&nbsp;</td><td><a href="#%28part._gc-perf%29" class="tocviewlink" data-pltdoc="x">&#20869;&#23384;&#31649;&#29702;</a></td></tr><tr><td align="right">19.12&nbsp;</td><td><a href="#%28part._.Reachability._and._.Garbage._.Collection%29" class="tocviewlink" data-pltdoc="x">&#21487;&#36798;&#24615;&#19982;&#22403;&#22334;&#25910;&#38598;</a></td></tr><tr><td align="right">19.13&nbsp;</td><td><a href="#%28part._.Weak_.Boxes_and_.Testing%29" class="tocviewlink" data-pltdoc="x">Weak Boxes and Testing</a></td></tr><tr><td align="right">19.14&nbsp;</td><td><a href="#%28part._.Reducing_.Garbage_.Collection_.Pauses%29" class="tocviewlink" data-pltdoc="x">Reducing Garbage Collection Pauses</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">19.1<tt>&nbsp;</tt></span><a href="#%28part._.Dr.Racket-perf%29" class="tocsubseclink" data-pltdoc="x">Dr<span class="mywbr"> &nbsp;</span>Racket&#20013;&#30340;&#24615;&#33021;</a></td></tr><tr><td><span class="tocsublinknumber">19.2<tt>&nbsp;</tt></span><a href="#%28part._.J.I.T%29" class="tocsubseclink" data-pltdoc="x">&#23383;&#33410;&#30721;&#21644;&#21363;&#26102;&#65288;JIT&#65289;&#32534;&#35793;&#22120;</a></td></tr><tr><td><span class="tocsublinknumber">19.3<tt>&nbsp;</tt></span><a href="#%28part._modules-performance%29" class="tocsubseclink" data-pltdoc="x">&#27169;&#22359;&#21644;&#24615;&#33021;</a></td></tr><tr><td><span class="tocsublinknumber">19.4<tt>&nbsp;</tt></span><a href="#%28part._func-call-performance%29" class="tocsubseclink" data-pltdoc="x">&#20989;&#25968;&#35843;&#29992;&#20248;&#21270;</a></td></tr><tr><td><span class="tocsublinknumber">19.5<tt>&nbsp;</tt></span><a href="#%28part._~e7~aa~81~e5~8f~98~e5~92~8c~e6~80~a7~e8~83~bd%29" class="tocsubseclink" data-pltdoc="x">&#31361;&#21464;&#21644;&#24615;&#33021;</a></td></tr><tr><td><span class="tocsublinknumber">19.6<tt>&nbsp;</tt></span><a href="#%28part._letrec-performance%29" class="tocsubseclink" data-pltdoc="x"><span class="RktSym"><span class="badlink"><span class="RktValLink">letrec</span></span></span>&#24615;&#33021;</a></td></tr><tr><td><span class="tocsublinknumber">19.7<tt>&nbsp;</tt></span><a href="#%28part._fixnums%2Bflonums%29" class="tocsubseclink" data-pltdoc="x">Fixnum&#21644;Flonum&#20248;&#21270;</a></td></tr><tr><td><span class="tocsublinknumber">19.8<tt>&nbsp;</tt></span><a href="#%28part._unchecked-unsafe%29" class="tocsubseclink" data-pltdoc="x">&#26410;&#26816;&#26597;&#30340;&#12289;&#19981;&#23433;&#20840;&#30340;&#25805;&#20316;</a></td></tr><tr><td><span class="tocsublinknumber">19.9<tt>&nbsp;</tt></span><a href="#%28part._ffi-pointer-access%29" class="tocsubseclink" data-pltdoc="x">&#22806;&#26469;&#30340;&#25351;&#38024;</a></td></tr><tr><td><span class="tocsublinknumber">19.10<tt>&nbsp;</tt></span><a href="#%28part._regexp-perf%29" class="tocsubseclink" data-pltdoc="x">&#27491;&#21017;&#34920;&#36798;&#24335;&#24615;&#33021;</a></td></tr><tr><td><span class="tocsublinknumber">19.11<tt>&nbsp;</tt></span><a href="#%28part._gc-perf%29" class="tocsubseclink" data-pltdoc="x">&#20869;&#23384;&#31649;&#29702;</a></td></tr><tr><td><span class="tocsublinknumber">19.12<tt>&nbsp;</tt></span><a href="#%28part._.Reachability._and._.Garbage._.Collection%29" class="tocsubseclink" data-pltdoc="x">&#21487;&#36798;&#24615;&#19982;&#22403;&#22334;&#25910;&#38598;</a></td></tr><tr><td><span class="tocsublinknumber">19.13<tt>&nbsp;</tt></span><a href="#%28part._.Weak_.Boxes_and_.Testing%29" class="tocsubseclink" data-pltdoc="x">Weak Boxes and Testing</a></td></tr><tr><td><span class="tocsublinknumber">19.14<tt>&nbsp;</tt></span><a href="#%28part._.Reducing_.Garbage_.Collection_.Pauses%29" class="tocsubseclink" data-pltdoc="x">Reducing Garbage Collection Pauses</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="concurrency.html" title="backward to &quot;18 并发与同步&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Racket指南&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="parallelism.html" title="forward to &quot;20 Parallelism&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3>19<tt>&nbsp;</tt><a name="(part._performance)"></a><a name="(idx._(gentag._5))"></a><a name="(idx._(gentag._6))"></a>&#24615;&#33021;&#65288;Performance&#65289;</h3><p>Alan Perlis&#33879;&#21517;&#20339;&#21477;&#65306;&#8221;Lisp&#31243;&#24207;&#21592;&#30693;&#36947;&#19968;&#20999;&#30340;&#20215;&#20540;&#21644;&#34394;&#26080;&#30340;&#20195;&#20215;&#65288;Lisp programmers know the value of
everything and the cost of nothing&#65289;&#12290;&#8220;&#19968;&#20010;Racket&#31243;&#24207;&#21592;&#30693;&#36947;&#65292;&#20363;&#22914;&#65292;&#19968;&#20010;<span class="RktSym"><span class="badlink"><span class="RktValLink">lambda</span></span></span>&#31243;&#24207;&#20013;&#30340;&#20219;&#20309;&#22320;&#26041;&#37117;&#20250;&#29983;&#25104;&#19968;&#20010;&#22312;&#35789;&#27861;&#29615;&#22659;&#20013;&#23553;&#38381;&#30340;&#20540;&#8212;&#8212;&#20294;&#26159;&#20998;&#37197;&#36825;&#20010;&#20540;&#35201;&#22810;&#23569;&#20195;&#20215;&#21602;&#65311;&#31243;&#24207;&#21592;&#26377;&#19968;&#20010;&#21512;&#29702;&#32780;&#19988;&#24517;&#39035;&#25484;&#25569;&#30340;&#22312;&#26426;&#22120;&#30340;&#27700;&#24179;&#30340;&#21508;&#31181;&#25805;&#20316;&#30340;&#25104;&#26412;&#21644;&#25968;&#25454;&#32467;&#26500;&#65292;Racket&#35821;&#35328;&#27169;&#22411;&#21644;&#20248;&#20808;&#35745;&#31639;&#26426;&#26800;&#20043;&#38388;&#30340;&#24046;&#36317;&#21487;&#20197;&#26159;&#30456;&#24403;&#22823;&#30340;&#12290;</p><p>&#22312;&#36825;&#19968;&#31456;&#20013;&#65292;&#25105;&#20204;&#36890;&#36807;&#35299;&#37322;Racket&#32534;&#35793;&#22120;&#21644;&#36816;&#34892;&#26102;&#31995;&#32479;&#30340;&#32454;&#33410;&#20197;&#21450;&#23427;&#20204;&#22914;&#20309;&#24433;&#21709;Racket&#20195;&#30721;&#30340;&#36816;&#34892;&#26102;&#38388;&#21644;&#20869;&#23384;&#24615;&#33021;&#26469;&#32553;&#23567;&#36825;&#19968;&#24046;&#36317;&#12290;</p><h4>19.1<tt>&nbsp;</tt><a name="(part._.Dr.Racket-perf)"></a>DrRacket&#20013;&#30340;&#24615;&#33021;</h4><p>&#40664;&#35748;&#24773;&#20917;&#19979;&#65292;&#29992;&#20110;&#35843;&#35797;&#21644;&#35843;&#35797;&#24037;&#20855;&#30340;DrRacket&#24037;&#20855;&#31243;&#24207;&#65288;&#30001;<font class="badlink">(part ("(lib errortrace/scribblings/errortrace.scrbl)" "top"))</font>&#24211;&#25152;&#25552;&#20379;&#65289;&#33021;&#20026;&#19968;&#20123;&#31243;&#24207;&#26174;&#33879;&#22320;&#38477;&#20302;&#24615;&#33021;&#12290;&#21363;&#20351;&#35843;&#35797;&#22312;&#36890;&#36807;<span class="ssansserif">Choose Language...</span>&#23545;&#35805;&#26694;&#30340;<span class="ssansserif">Show Details&#65288;&#26174;&#31034;&#35814;&#32454;&#20449;&#24687;&#65289;</span>&#38754;&#26495;&#34987;&#31105;&#29992;&#65292;<span class="ssansserif">Preserve stacktrace</span>&#22797;&#36873;&#26694;&#40664;&#35748;&#34987;&#28857;&#20987;&#36873;&#25321;&#65292;&#36825;&#20063;&#20250;&#24433;&#21709;&#24615;&#33021;&#12290;&#31105;&#29992;&#35843;&#35797;&#22534;&#26632;&#20445;&#23384;&#25552;&#20379;&#24615;&#33021;&#32467;&#26524;&#65292;&#23427;&#26356;&#31526;&#21512;&#22312;&#26420;&#23454;&#26080;&#21326;&#30340;<span class="stt">racket</span>&#20013;&#36816;&#34892;&#12290;</p><p>&#21363;&#20415;&#22914;&#27492;&#65292;DrRacket&#21644;&#24320;&#21457;&#30340;&#31243;&#24207;&#22312;DrRacket&#20013;&#20351;&#29992;&#30456;&#21516;&#30340;Racket&#34394;&#25311;&#26426;&#65292;&#25152;&#20197;&#22312;DrRacket&#30340;&#22403;&#22334;&#25910;&#38598;&#26102;&#38388;&#65288;&#35265;<a href="#%28part._gc-perf%29" data-pltdoc="x">&#20869;&#23384;&#31649;&#29702;</a>&#65289;&#21487;&#33021;&#20250;&#27604;&#31243;&#24207;&#26412;&#36523;&#36816;&#34892;&#26102;&#38388;&#26356;&#38271;&#65292;&#21516;&#26102;DrRacket&#32447;&#31243;&#21487;&#33021;&#22952;&#30861;&#31243;&#24207;&#32447;&#31243;&#30340;&#25191;&#34892;&#12290;<span style="font-weight: bold">&#23545;&#20110;&#19968;&#20010;&#31243;&#24207;&#30340;&#26368;&#21487;&#38752;&#30340;&#35745;&#26102;&#32467;&#26524;&#65292;&#26159;&#22312;&#26222;&#36890;&#30340;<span class="stt">racket</span>&#20013;&#36816;&#34892;&#32780;&#19981;&#26159;&#22312;DrRacket&#24320;&#21457;&#29615;&#22659;&#20013;&#36816;&#34892;&#12290;</span>&#23545;&#27169;&#22359;&#30340;&#31995;&#32479;&#30340;&#25928;&#30410;&#26469;&#35762;&#38750;&#20132;&#20114;&#24335;&#27169;&#24335;&#24212;&#35813;&#29992;&#26469;&#20195;&#26367;<a href="intro.html#%28tech._repl%29" class="techoutside" data-pltdoc="x"><span class="techinside">REPL</span></a>&#12290;&#35814;&#24773;&#35831;&#21442;&#35265;<a href="#%28part._modules-performance%29" data-pltdoc="x">&#27169;&#22359;&#21644;&#24615;&#33021;</a>&#12290;</p><h4>19.2<tt>&nbsp;</tt><a name="(part._.J.I.T)"></a>&#23383;&#33410;&#30721;&#21644;&#21363;&#26102;&#65288;JIT&#65289;&#32534;&#35793;&#22120;</h4><p>&#23558;&#35201;&#34987;Racket&#27714;&#20540;&#30340;&#27599;&#20010;&#23450;&#20041;&#25110;&#34920;&#36798;&#24335;&#37117;&#32534;&#35793;&#25104;&#19968;&#20010;&#20869;&#37096;&#23383;&#33410;&#30721;&#26684;&#24335;&#12290;&#22312;&#20132;&#20114;&#27169;&#24335;&#19979;&#65292;&#36825;&#31181;&#32534;&#35793;&#26159;&#33258;&#21160;&#36827;&#34892;&#24182;&#19988;&#24555;&#36895;&#12290;&#21516;&#26102;&#65292;<span class="stt">raco make</span>&#21644;<span class="stt">raco setup</span>&#36825;&#26679;&#30340;&#24037;&#20855;&#23558;&#32534;&#35793;&#30340;&#23383;&#33410;&#30721;&#32534;&#32452;&#21040;&#19968;&#20010;&#25991;&#20214;&#20013;&#65292;&#22240;&#27492;&#20320;&#19981;&#24517;&#27599;&#27425;&#20320;&#36816;&#34892;&#19968;&#20010;&#31243;&#24207;&#26102;&#20174;&#28304;&#20195;&#30721;&#20013;&#32534;&#35793;&#12290;&#65288;&#34987;&#38656;&#35201;&#21435;&#32534;&#35793;&#19968;&#20010;&#25991;&#20214;&#30340;&#22823;&#37096;&#20998;&#26102;&#38388;&#23454;&#38469;&#19978;&#26159;&#22788;&#20110;&#23439;&#25193;&#23637;&#20013;&#65307;&#23436;&#20840;&#23637;&#24320;&#30340;&#20195;&#30721;&#29983;&#25104;&#30340;&#23383;&#33410;&#30721;&#26159;&#27604;&#36739;&#24555;&#30340;&#12290;&#65289;&#21442;&#35265;<a href="cmdline-tools.html#%28part._compile%29" data-pltdoc="x">Compilation and Configuration: <span class="stt">raco</span></a>&#33719;&#21462;&#29983;&#25104;&#23383;&#33410;&#30721;&#25991;&#20214;&#30340;&#26356;&#22810;&#20449;&#24687;&#12290;</p><p>&#23383;&#33410;&#30721;&#32534;&#35793;&#22120;&#24212;&#29992;&#25152;&#26377;&#26631;&#20934;&#30340;&#20248;&#21270;&#65292;&#27604;&#22914;&#24120;&#37327;&#20256;&#36755;&#12289;&#24120;&#37327;&#25240;&#21472;&#12289;&#20869;&#32852;&#65292;&#21644;&#27515;&#20195;&#30721;&#28040;&#38500;&#12290;&#20363;&#22914;&#65292;&#22312;&#19968;&#20010;<span class="RktSym"><span class="badlink"><span class="RktValLink">+</span></span></span>&#26377;&#20854;&#36890;&#24120;&#30340;&#32465;&#23450;&#30340;&#29615;&#22659;&#20013;&#65292;&#34920;&#36798;&#24335;<span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">let</span></span></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktPn">]</span><span class="stt"> </span><span class="RktPn">[</span><span class="RktSym">y</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">lambda</span></span></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktVal">4</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">+</span></span></span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span>&#34987;&#32534;&#35793;&#25104;&#24120;&#37327; <span class="RktVal">5</span>&#12290;</p><p>&#22312;&#19968;&#20123;&#24179;&#21488;&#19978;&#65292;&#23383;&#33410;&#30721;&#36890;&#36807;&#19968;&#20010;<a name="(tech._just._in._time)"></a><span style="font-style: italic">just-in-time</span>&#32534;&#35793;&#22120;&#25110;<font class="badlink"><span class="techoutside"><span class="techinside">JIT</span></span></font>&#32534;&#35793;&#22120;&#36827;&#19968;&#27493;&#32534;&#35793;&#25104;&#26412;&#26426;&#20195;&#30721;&#12290;JIT&#32534;&#35793;&#22120;&#20805;&#20998;&#21152;&#24555;&#25191;&#34892;&#32039;&#20945;&#30340;&#24490;&#29615;&#30340;&#31243;&#24207;&#12289;&#23567;&#25972;&#25968;&#31639;&#27861;&#20197;&#21450;&#19981;&#31934;&#30830;&#23454;&#25968;&#31639;&#27861;&#12290;&#30446;&#21069;&#65292;<font class="badlink"><span class="techoutside"><span class="techinside">JIT</span></span></font>&#32534;&#35793;&#25903;&#25345;x86&#12289;x86_64&#65288;&#20063;&#21483;&#20316;AMD64&#65289;&#12289;ARM&#21644;32&#20301;PowerPC&#22788;&#29702;&#22120;&#12290;<font class="badlink"><span class="techoutside"><span class="techinside">JIT</span></span></font>&#32534;&#35793;&#22120;&#21487;&#20197;&#36890;&#36807;<span class="RktSym"><span class="badlink"><span class="RktValLink">eval-jit-enabled</span></span></span>&#21442;&#25968;&#25110;&#32773;<span class="nobreak"><span class="stt">--no-jit</span></span>/<span class="nobreak"><span class="stt">-j</span></span>&#21629;&#20196;&#34892;&#26631;&#24535;&#30340;<span class="stt">racket</span>&#31105;&#29992;&#12290;</p><p><font class="badlink"><span class="techoutside"><span class="techinside">JIT</span></span></font>&#32534;&#35793;&#22120;&#38543;&#30528;&#20989;&#25968;&#30340;&#24212;&#29992;&#36880;&#27493;&#22320;&#24037;&#20316;&#65292;&#20294;&#26159;<font class="badlink"><span class="techoutside"><span class="techinside">JIT</span></span></font>&#32534;&#35793;&#22120;&#22312;&#32534;&#35793;&#36807;&#31243;&#26102;&#21482;&#23545;&#36816;&#34892;&#26102;&#20449;&#24687;&#36827;&#34892;&#26377;&#38480;&#30340;&#20351;&#29992;&#65292;&#22240;&#20026;&#32473;&#23450;&#30340;&#27169;&#22359;&#20027;&#20307;&#25110;<span class="RktSym"><span class="badlink"><span class="RktValLink">lambda</span></span></span>&#25277;&#35937;&#21482;&#32534;&#35793;&#19968;&#27425;&#12290;<font class="badlink"><span class="techoutside"><span class="techinside">JIT</span></span></font>&#30340;&#32534;&#35793;&#30340;&#31890;&#24230;&#26159;&#19968;&#20010;&#21333;&#19968;&#30340;&#31243;&#24207;&#20307;&#65292;&#19981;&#35745;&#31639;&#20219;&#20309;&#23884;&#22871;&#30340;&#31243;&#24207;&#30340;&#20027;&#20307;&#12290;<font class="badlink"><span class="techoutside"><span class="techinside">JIT</span></span></font>&#32534;&#35793;&#30340;&#24320;&#38144;&#36890;&#24120;&#24456;&#23567;&#20197;&#33268;&#24456;&#38590;&#26816;&#27979;&#21040;&#12290;</p><h4>19.3<tt>&nbsp;</tt><a name="(part._modules-performance)"></a>&#27169;&#22359;&#21644;&#24615;&#33021;</h4><p>&#27169;&#22359;&#31995;&#32479;&#36890;&#36807;&#24110;&#21161;&#30830;&#20445;&#26631;&#35782;&#31526;&#20855;&#26377;&#36890;&#24120;&#30340;&#32465;&#23450;&#26469;&#24110;&#21161;&#20248;&#21270;&#12290;&#37027;&#26159;&#65292;&#36890;&#36807;<font class="badlink"><span class="RktModLink"><span class="RktSym">racket/base</span></span></font>&#25552;&#20379;&#30340;<span class="RktSym"><span class="badlink"><span class="RktValLink">+</span></span></span>&#21487;&#30001;&#32534;&#35793;&#22120;&#36776;&#21035;&#24182;&#20869;&#32852;&#65292;&#36825;&#23545;<font class="badlink"><span class="techoutside"><span class="techinside">JIT</span></span></font>&#32534;&#35793;&#30340;&#20195;&#30721;&#26159;&#29305;&#21035;&#37325;&#35201;&#30340;&#12290;&#30456;&#21453;&#65292;&#22312;&#19968;&#20010;&#20256;&#32479;&#30340;&#20132;&#20114;&#24335;Scheme&#31995;&#32479;&#20013;&#65292;&#39030;&#23618;&#30340;<span class="RktSym"><span class="badlink"><span class="RktValLink">+</span></span></span>&#32465;&#23450;&#21487;&#33021;&#34987;&#37325;&#26032;&#23450;&#20041;&#65292;&#22240;&#27492;&#32534;&#35793;&#22120;&#19981;&#33021;&#20551;&#23450;&#19968;&#20010;&#22266;&#23450;&#30340;<span class="RktSym"><span class="badlink"><span class="RktValLink">+</span></span></span>&#32465;&#23450;&#65288;&#38500;&#38750;&#29305;&#27530;&#30340;&#26631;&#24535;&#25110;&#22768;&#26126;&#29992;&#20110;&#24357;&#34917;&#27169;&#22359;&#31995;&#32479;&#30340;&#19981;&#36275;&#65289;&#12290;</p><p>&#21363;&#20351;&#22312;&#39030;&#32423;&#29615;&#22659;&#20013;&#65292;&#24102;<span class="RktSym"><span class="badlink"><span class="RktValLink">require</span></span></span>&#30340;&#23548;&#20837;&#20351;&#19968;&#20123;&#20869;&#32852;&#20248;&#21270;&#25104;&#20026;&#21487;&#33021;&#12290;&#23613;&#31649;&#19968;&#20010;&#22312;&#39030;&#23618;&#30340;<span class="RktSym"><span class="badlink"><span class="RktValLink">+</span></span></span>&#23450;&#20041;&#21487;&#33021;&#20250;&#23545;&#35206;&#30422;&#19968;&#20010;&#23548;&#20837;&#30340;<span class="RktSym"><span class="badlink"><span class="RktValLink">+</span></span></span>&#65292;&#20294;&#35206;&#30422;&#23450;&#20041;&#21482;&#36866;&#29992;&#20110;&#31245;&#21518;&#27714;&#20540;&#30340;&#34920;&#36798;&#24335;&#12290;</p><p>&#22312;&#27169;&#22359;&#20013;&#65292;&#20869;&#32852;&#21644;&#24120;&#25968;&#20256;&#36755;&#20248;&#21270;&#37319;&#21462;&#39069;&#22806;&#30340;&#20248;&#21183;&#65292;&#22312;&#27169;&#22359;&#20013;&#19981;&#33021;&#23450;&#20041;&#21487;&#20197;&#31361;&#21464;&#26102;&#27809;&#26377;<span class="RktSym"><span class="badlink"><span class="RktValLink">set!</span></span></span>&#22312;&#32534;&#35793;&#26102;&#21487;&#35265;&#12290;&#27492;&#31867;&#20248;&#21270;&#22312;&#39030;&#23618;&#29615;&#22659;&#20013;&#19981;&#21487;&#29992;&#12290;&#34429;&#28982;&#27169;&#22359;&#20869;&#30340;&#20248;&#21270;&#23545;&#24615;&#33021;&#24456;&#37325;&#35201;&#65292;&#20294;&#23427;&#38459;&#30861;&#20102;&#19968;&#20123;&#20132;&#20114;&#24320;&#21457;&#21644;&#25506;&#32034;&#30340;&#24418;&#24335;&#12290;&#24403;&#20132;&#20114;&#25506;&#32034;&#26356;&#37325;&#35201;&#26102;&#65292;<span class="RktSym"><span class="badlink"><span class="RktValLink">compile-enforce-module-constants</span></span></span>&#21442;&#25968;&#31105;&#29992;<font class="badlink"><span class="techoutside"><span class="techinside">JIT</span></span></font>&#32534;&#35793;&#22120;&#20851;&#20110;&#27169;&#22359;&#23450;&#20041;&#30340;&#20551;&#35774;&#12290;&#26377;&#20851;&#26356;&#22810;&#20449;&#24687;&#65292;&#35831;&#21442;&#38405;<a href="module-set.html" data-pltdoc="x">Assignment and Redefinition</a>&#12290;</p><p>&#32534;&#35793;&#22120;&#21487;&#20197;&#20869;&#32852;&#20989;&#25968;&#25110;&#22312;&#27169;&#22359;&#36793;&#30028;&#19978;&#20256;&#25773;&#24120;&#37327;&#12290;&#20026;&#20102;&#36991;&#20813;&#22312;&#20869;&#32852;&#20989;&#25968;&#30340;&#24773;&#20917;&#19979;&#20135;&#29983;&#20102;&#22826;&#22810;&#30340;&#20195;&#30721;&#65292;&#32534;&#35793;&#22120;&#26159;&#20445;&#23432;&#30340;&#36328;&#27169;&#22359;&#20869;&#32852;&#36873;&#25321;&#20505;&#36873;&#20154;&#65307;&#30475;&#21040;&#20989;&#25968;&#35843;&#29992;&#30340;&#20248;&#21270;&#25552;&#20379;&#32473;&#32534;&#35793;&#22120;&#20869;&#32852;&#25552;&#31034;&#20449;&#24687;&#12290;</p><p>&#21518;&#36793;&#30340;&#31456;&#33410;<a href="#%28part._letrec-performance%29" data-pltdoc="x"><span class="RktSym"><span class="badlink"><span class="RktValLink">letrec</span></span></span>&#24615;&#33021;</a>&#25552;&#20379;&#19968;&#20123;&#39069;&#22806;&#30340;&#20851;&#20110;&#27169;&#22359;&#32465;&#23450;&#20869;&#32852;&#30340;&#38468;&#21152;&#35828;&#26126;&#12290;</p><h4>19.4<tt>&nbsp;</tt><a name="(part._func-call-performance)"></a>&#20989;&#25968;&#35843;&#29992;&#20248;&#21270;</h4><p>&#24403;&#32534;&#35793;&#22120;&#26816;&#27979;&#21040;&#19968;&#20010;&#23545;&#21363;&#26102;&#21487;&#35265;&#20989;&#25968;&#30340;&#20989;&#25968;&#35843;&#29992;&#26102;&#65292;&#23427;&#29983;&#25104;&#30340;&#20195;&#30721;&#27604;&#19968;&#33324;&#35843;&#29992;&#26356;&#39640;&#25928;&#65292;&#23588;&#20854;&#26159;&#23545;&#20110;&#23614;&#37096;&#35843;&#29992;&#12290;&#20363;&#22914;&#65292;&#32473;&#23450;&#31243;&#24207;</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">letrec</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">odd</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">lambda</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">if</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">zero?</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">even</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">sub1</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">even</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">lambda</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">if</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">zero?</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#t</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">odd</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">sub1</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">odd</span><span class="hspace">&nbsp;</span><span class="RktVal">40000000</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>&#32534;&#35793;&#22120;&#21487;&#20197;&#26816;&#27979;<span class="RktSym">odd</span>&ndash;<span class="RktSym">even</span>&#24490;&#29615;&#24182;&#36890;&#36807;&#24490;&#29615;&#23637;&#24320;&#21644;&#30456;&#20851;&#30340;&#20248;&#21270;&#20135;&#29983;&#36816;&#34892;&#36895;&#24230;&#26356;&#24555;&#30340;&#20195;&#30721;&#12290;</p><p>&#22312;&#19968;&#20010;&#27169;&#22359;&#34920;&#37324;&#65292;<span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span>&#21464;&#37327;&#26159;&#20687;<span class="RktSym"><span class="badlink"><span class="RktValLink">letrec</span></span></span>&#32465;&#23450;&#36825;&#26679;&#30340;&#35789;&#27861;&#20316;&#29992;&#22495;&#65292;&#24182;&#19988;&#23450;&#20041;&#22312;&#19968;&#20010;&#27169;&#22359;&#20869;&#22240;&#27492;&#20801;&#35768;&#35843;&#29992;&#20248;&#21270;&#65292;&#37027;&#20040;</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">odd</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">....</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">even</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">....</span><span class="RktPn">)</span></td></tr></table></blockquote><p>&#20854;&#20013;&#19968;&#20010;&#27169;&#22359;&#21487;&#20197;&#25191;&#34892;&#30456;&#21516;&#30340;<span class="RktSym"><span class="badlink"><span class="RktValLink">letrec</span></span></span>&#29256;&#26412;&#12290;</p><p>&#23545;&#20110;&#24102;&#26377;&#20851;&#38190;&#23383;&#21442;&#25968;&#30340;&#20989;&#25968;&#30340;&#30452;&#25509;&#35843;&#29992;&#65292;&#32534;&#35793;&#22120;&#36890;&#24120;&#21487;&#20197;&#38745;&#24577;&#26816;&#26597;&#20851;&#38190;&#23383;&#21442;&#25968;&#24182;&#29983;&#25104;&#19968;&#20010;&#23545;&#20989;&#25968;&#38750;&#20851;&#38190;&#23383;&#21464;&#20307;&#30340;&#30452;&#25509;&#35843;&#29992;&#65292;&#20174;&#32780;&#20943;&#23569;&#20851;&#38190;&#23383;&#26816;&#26597;&#30340;&#36816;&#34892;&#26102;&#24320;&#38144;&#12290;&#27492;&#20248;&#21270;&#20165;&#36866;&#29992;&#20110;&#29992;<span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span>&#32465;&#23450;&#30340;&#25509;&#21463;&#20851;&#38190;&#23383;&#30340;&#36807;&#31243;&#12290;</p><p>&#23545;&#20110;&#23545;&#36275;&#22815;&#23567;&#30340;&#20989;&#25968;&#30340;&#21363;&#26102;&#35843;&#29992;&#65292;&#32534;&#35793;&#22120;&#21487;&#20197;&#36890;&#36807;&#20989;&#25968;&#30340;&#20027;&#20307;&#26367;&#25442;&#35843;&#29992;&#26469;&#20869;&#32852;&#20989;&#25968;&#35843;&#29992;&#12290;&#38500;&#20102;&#30446;&#26631;&#20989;&#25968;&#20307;&#30340;&#22823;&#23567;&#20043;&#22806;&#65292;&#32534;&#35793;&#22120;&#30340;&#21551;&#21457;&#24335;&#32771;&#34385;&#37327;&#24050;&#32463;&#36827;&#34892;&#20869;&#32852;&#35843;&#29992;&#31449;&#28857;&#19978;&#26159;&#21542;&#34987;&#35843;&#29992;&#20989;&#25968;&#26412;&#36523;&#35843;&#29992;&#20854;&#20182;&#27604;&#31616;&#21333;&#30340;&#22522;&#26412;&#25805;&#20316;&#20989;&#25968;&#12290;&#24403;&#19968;&#20010;&#27169;&#22359;&#34987;&#32534;&#35793;&#65292;&#22312;&#27169;&#22359;&#32423;&#23450;&#20041;&#19968;&#20123;&#20989;&#25968;&#30830;&#23450;&#20026;&#20869;&#32852;&#21040;&#20854;&#20182;&#27169;&#22359;&#30340;&#20505;&#36873;&#20154;&#65307;&#36890;&#24120;&#24773;&#20917;&#19979;&#65292;&#21482;&#26377;&#24494;&#19981;&#36275;&#36947;&#30340;&#21151;&#33021;&#34987;&#35748;&#20026;&#26159;&#36328;&#27169;&#22359;&#20869;&#23884;&#30340;&#20505;&#36873;&#20154;&#65292;&#20294;&#31243;&#24207;&#21592;&#21487;&#20197;&#25226;&#20989;&#25968;&#23450;&#20041;&#24320;&#22987;&#40723;&#21169;&#40723;&#21169;&#20869;&#32852;&#20869;&#32852;&#20989;&#25968;&#12290;</p><p>&#20687;<span class="RktSym"><span class="badlink"><span class="RktValLink">pair?</span></span></span>&#12289;<span class="RktSym"><span class="badlink"><span class="RktValLink">car</span></span></span>&#21644;<span class="RktSym"><span class="badlink"><span class="RktValLink">cdr</span></span></span>&#36825;&#26679;&#30340;&#21407;&#22987;&#25805;&#20316;&#26159;&#22312;&#26426;&#22120;&#20195;&#30721;&#32423;&#34987;<font class="badlink"><span class="techoutside"><span class="techinside">JIT</span></span></font>&#32534;&#35793;&#22120;&#20869;&#32852;&#12290;&#21442;&#35265;&#21518;&#38754;&#30340;&#31456;&#33410;<a href="#%28part._fixnums%2Bflonums%29" data-pltdoc="x">Fixnum&#21644;Flonum&#20248;&#21270;</a>&#33719;&#21462;&#20851;&#20110;&#20869;&#32852;&#30340;&#31639;&#26415;&#36816;&#31639;&#30340;&#20449;&#24687;&#12290;</p><h4>19.5<tt>&nbsp;</tt><a name="(part._~e7~aa~81~e5~8f~98~e5~92~8c~e6~80~a7~e8~83~bd)"></a>&#31361;&#21464;&#21644;&#24615;&#33021;</h4><p>&#21033;&#29992;<span class="RktSym"><span class="badlink"><span class="RktValLink">set!</span></span></span>&#31361;&#21464;&#19968;&#20010;&#21464;&#37327;&#20250;&#23548;&#33268;&#22351;&#30340;&#24615;&#33021;&#12290;&#20363;&#22914;&#65292;&#23567;&#35268;&#27169;&#22522;&#20934;&#27979;&#35797;</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="hspace">&nbsp;</span><font class="badlink"><span class="RktModLink"><span class="RktSym">racket/base</span></span></font></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">subtract-one</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">set!</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">sub1</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">time</span></span></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">let</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">4000000</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">if</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">zero?</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">done</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">subtract-one</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>&#27604;&#21516;&#31561;&#30340;&#24930;&#24471;&#22810;</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="hspace">&nbsp;</span><font class="badlink"><span class="RktModLink"><span class="RktSym">racket/base</span></span></font></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">subtract-one</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">sub1</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">time</span></span></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">let</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">4000000</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">if</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">zero?</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">done</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">subtract-one</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>&#22312;&#31532;&#19968;&#20010;&#21464;&#37327;&#20013;&#65292;&#27599;&#27425;&#36845;&#20195;&#37117;&#20026;<span class="RktSym">x</span>&#20998;&#37197;&#19968;&#20010;&#26032;&#20301;&#32622;&#65292;&#23548;&#33268;&#24615;&#33021;&#19981;&#20339;&#12290;&#19968;&#20010;&#26356;&#32874;&#26126;&#30340;&#32534;&#35793;&#22120;&#21487;&#20197;&#35299;&#24320;&#22312;&#31532;&#19968;&#20010;&#31034;&#20363;&#20013;<span class="RktSym"><span class="badlink"><span class="RktValLink">set!</span></span></span>&#30340;&#20351;&#29992;&#65292;&#30001;&#20110;&#19981;&#25903;&#25345;&#31361;&#21464;&#65288;&#21442;&#35265;<a href="set_.html#%28part._using-set%21%29" data-pltdoc="x">Guidelines for Using Assignment</a>&#65289;&#65292;&#32534;&#35793;&#22120;&#30340;&#21162;&#21147;&#23558;&#33457;&#36153;&#22312;&#20854;&#23427;&#22320;&#26041;&#12290;</p><p>&#26356;&#37325;&#35201;&#30340;&#26159;&#65292;&#31361;&#21464;&#21487;&#20197;&#25513;&#30422;&#22312;&#20869;&#32852;&#21644;&#20256;&#25773;&#24120;&#25968;&#21487;&#33021;&#24212;&#29992;&#30340;&#32465;&#23450;&#12290;&#20363;&#22914;&#65292;&#22312;</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">let</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">minus1</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">set!</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">minus1</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">sub1</span></span></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">let</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">4000000</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">if</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">zero?</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">done</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">minus1</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p><span class="RktSym"><span class="badlink"><span class="RktValLink">set!</span></span></span>&#25513;&#30422;&#20102;&#19968;&#20010;&#20107;&#23454;&#65306;<span class="RktSym">minus1</span>&#21482;&#26159;&#32473;&#20869;&#32622;&#30340;<span class="RktSym"><span class="badlink"><span class="RktValLink">sub1</span></span></span>&#30340;&#21478;&#19968;&#20010;&#21517;&#23383;&#12290;</p><h4>19.6<tt>&nbsp;</tt><a name="(part._letrec-performance)"></a><span class="RktSym"><span class="badlink"><span class="RktValLink">letrec</span></span></span>&#24615;&#33021;</h4><p>&#24403;<span class="RktSym"><span class="badlink"><span class="RktValLink">letrec</span></span></span>&#34987;&#29992;&#20110;&#20165;&#32465;&#23450;&#36807;&#31243;&#21644;&#23383;&#38754;&#37327;&#65292;&#37027;&#20040;&#32534;&#35793;&#22120;&#33021;&#22815;&#20197;&#26368;&#20339;&#26041;&#24335;&#22788;&#29702;&#32465;&#23450;&#65292;&#26377;&#25928;&#32534;&#35793;&#32465;&#23450;&#30340;&#20351;&#29992;&#12290;&#24403;&#20854;&#23427;&#31867;&#22411;&#30340;&#32465;&#23450;&#19982;&#31243;&#24207;&#28151;&#21512;&#26102;&#65292;&#32534;&#35793;&#22120;&#20063;&#35768;&#19981;&#22826;&#33021;&#30830;&#23450;&#25511;&#21046;&#27969;&#12290;</p><p>&#20363;&#22914;&#65292;</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">letrec</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">lambda</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">if</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">zero?</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">done</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">next</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">junk</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">display</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">loop</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">next</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">lambda</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">sub1</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktVal">40000000</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>&#21487;&#33021;&#32534;&#35793;&#25104;&#27604;&#20197;&#19979;&#20869;&#23481;&#25928;&#29575;&#26356;&#20302;&#30340;&#20195;&#30721;</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">letrec</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">lambda</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">if</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">zero?</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">done</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">next</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">next</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">lambda</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">sub1</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktVal">40000000</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>&#22312;&#31532;&#19968;&#31181;&#24773;&#20917;&#19979;&#65292;&#32534;&#35793;&#22120;&#21487;&#33021;&#19981;&#30693;&#36947;<span class="RktSym"><span class="badlink"><span class="RktValLink">display</span></span></span>&#19981;&#35843;&#29992;<span class="RktSym">loop</span>&#12290;&#22914;&#26524;&#26159;&#65292;&#37027;&#20040;<span class="RktSym">loop</span>&#21487;&#33021;&#22312;&#32465;&#23450;&#25104;&#20026;&#21487;&#33719;&#24471;&#30340;&#20043;&#21069;&#24341;&#29992;<span class="RktSym">next</span>&#12290;</p><p>&#36825;&#20851;&#20110;<span class="RktSym"><span class="badlink"><span class="RktValLink">letrec</span></span></span>&#30340;&#38468;&#21152;&#35828;&#26126;&#20063;&#36866;&#29992;&#20110;&#20316;&#20026;&#20869;&#37096;&#23450;&#20041;&#25110;&#27169;&#22359;&#30340;&#20989;&#25968;&#21644;&#24120;&#37327;&#30340;&#23450;&#20041;&#12290;&#22312;&#19968;&#20010;&#27169;&#22359;&#20027;&#20307;&#20013;&#30340;&#19968;&#20010;&#23450;&#20041;&#24207;&#21015;&#31867;&#20284;&#20110;&#19968;&#20010;<span class="RktSym"><span class="badlink"><span class="RktValLink">letrec</span></span></span>&#32465;&#23450;&#24207;&#21015;&#65292;&#21516;&#26102;&#22312;&#19968;&#20010;&#27169;&#22359;&#20027;&#20307;&#20013;&#30340;&#38750;&#24120;&#25968;&#34920;&#36798;&#24335;&#21487;&#20197;&#29992;&#21518;&#26399;&#32465;&#23450;&#24341;&#29992;&#30340;&#20248;&#21270;&#24178;&#28041;&#12290;</p><h4>19.7<tt>&nbsp;</tt><a name="(part._fixnums+flonums)"></a>Fixnum&#21644;Flonum&#20248;&#21270;</h4><p>&#19968;&#20010;<a name="(tech._fixnum)"></a><span style="font-style: italic">fixnum</span>&#26159;&#19968;&#20010;&#23567;&#30340;&#31934;&#30830;&#30340;&#25972;&#25968;&#12290;&#22312;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#8220;&#23567;&#8221;&#21462;&#20915;&#20110;&#24179;&#21488;&#12290;&#23545;&#20110;&#19968;&#20010;32&#20301;&#30340;&#26426;&#22120;&#65292;&#21487;&#20197;&#22312;30&#20301;&#21152;&#19968;&#20010;&#31526;&#21495;&#20301;&#34920;&#31034;&#30340;&#25968;&#23383;&#20195;&#34920;fixnum&#12290;&#22312;64&#20301;&#26426;&#22120;&#19978;&#65292;&#21487;&#29992;62&#20301;&#21152;&#19968;&#20010;&#31526;&#21495;&#20301;&#12290;</p><p>&#19968;&#20010;<a name="(tech._flonum)"></a><span style="font-style: italic">flonum</span>&#29992;&#26469;&#34920;&#31034;&#20219;&#20309;&#19981;&#31934;&#30830;&#23454;&#25968;&#12290;&#23427;&#20204;&#23545;&#24212;&#20110;&#25152;&#26377;&#24179;&#21488;&#19978;&#30340;64&#20301;IEEE&#28014;&#28857;&#25968;&#12290;</p><p>&#20869;&#32852;fixnum&#21644;flonum&#31639;&#26415;&#36816;&#31639;&#26159;<font class="badlink"><span class="techoutside"><span class="techinside">JIT</span></span></font>&#32534;&#35793;&#22120;&#30340;&#26368;&#37325;&#35201;&#30340;&#22909;&#22788;&#12290;&#20363;&#22914;&#65292;&#24403;<span class="RktSym"><span class="badlink"><span class="RktValLink">+</span></span></span>&#24212;&#29992;&#20110;&#20004;&#20010;&#21442;&#25968;&#65292;&#29983;&#25104;&#30340;&#26426;&#22120;&#20195;&#30721;&#30340;&#27979;&#35797;&#26159;&#21542;&#20004;&#21442;&#25968;&#26159;fixnum&#65292;&#22914;&#26524;&#26159;&#30340;&#35805;&#65292;&#23427;&#20351;&#29992;&#26426;&#22120;&#30340;&#25351;&#20196;&#28155;&#21152;&#25968;&#23383;&#65288;&#21644;&#28322;&#20986;&#26816;&#26597;&#65289;&#12290;&#22914;&#26524;&#36825;&#20004;&#20010;&#25968;&#23383;&#37117;&#19981;fixnum&#65292;&#28982;&#21518;&#26816;&#26597;&#26159;&#21542;&#37117;flonum&#65307;&#22312;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#30452;&#25509;&#20351;&#29992;&#26426;&#22120;&#30340;&#28014;&#28857;&#36816;&#31639;&#12290;&#24403;&#21442;&#25968;&#26082;&#26159;&#25152;&#26377;fixnum&#20063;&#26159;flonum&#26102;&#65292;&#23545;&#20110;&#20989;&#25968;&#21487;&#20197;&#25509;&#21463;&#20219;&#24847;&#25968;&#37327;&#30340;&#21442;&#25968;&#65292;&#22914;<span class="RktSym"><span class="badlink"><span class="RktValLink">+</span></span></span>&#12289;&#23545;&#20004;&#20010;&#25110;&#20004;&#20010;&#20197;&#19978;&#21442;&#25968;&#30340;&#20869;&#32852;&#24037;&#20316;&#65288;&#38500;<span class="RktSym"><span class="badlink"><span class="RktValLink">-</span></span></span>&#20043;&#22806;&#65292;&#20854;&#20105;&#35770;&#30340;&#28966;&#28857;&#20043;&#19968;&#26159;&#20869;&#32852;&#65289;&#12290;</p><p>flonum&#36890;&#24120;&#26159;<span style="font-style: italic">&#34987;&#35013;&#31665;&#65288;boxed&#65289;</span>&#65292;&#36825;&#24847;&#21619;&#30528;&#20869;&#23384;&#34987;&#20998;&#37197;&#20197;&#23481;&#32435;&#27599;&#19968;&#20010;flonum&#35745;&#31639;&#32467;&#26524;&#12290;&#24184;&#36816;&#30340;&#26159;&#65292;&#19990;&#20195;&#30340;&#22403;&#22334;&#25910;&#38598;&#22120;&#65288;&#31245;&#21518;&#22312;<a href="#%28part._gc-perf%29" data-pltdoc="x">&#20869;&#23384;&#31649;&#29702;</a>&#20013;&#25551;&#36848;&#65289;&#20026;&#36739;&#30701;&#30340;&#32467;&#26524;&#24265;&#20215;&#22320;&#20570;&#20998;&#37197;&#12290;fixnum&#30456;&#27604;&#20043;&#19979;&#27809;&#26377;&#34987;&#35013;&#31665;&#65292;&#25152;&#20197;&#20182;&#20204;&#36890;&#24120;&#24265;&#20215;&#22320;&#20351;&#29992;&#12290;</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>&#35265;<a href="parallelism.html#%28part._effective-futures%29" data-pltdoc="x">Parallelism with Futures</a>&#20197;&#20102;&#35299;&#19968;&#20010;<a href="#%28tech._flonum%29" class="techoutside" data-pltdoc="x"><span class="techinside">flonum</span></a>&#20855;&#20307;&#25805;&#20316;&#30340;&#20351;&#29992;&#20363;&#23376;&#12290;</p></blockquote></blockquote></blockquote><p><font class="badlink"><span class="RktModLink"><span class="RktSym">racket/flonum</span></span></font>&#24211;&#25552;&#20379;flonum&#20855;&#20307;&#25805;&#20316;&#65292;&#20197;&#21450;flonum&#25805;&#20316;&#30340;&#32452;&#21512;&#20801;&#35768;<font class="badlink"><span class="techoutside"><span class="techinside">JIT</span></span></font>&#32534;&#35793;&#22120;&#29983;&#25104;&#20195;&#30721;&#65292;&#23427;&#36991;&#20813;&#35013;&#31665;&#21644;&#25286;&#31665;&#30340;&#20013;&#38388;&#32467;&#26524;&#12290;&#38500;&#20102;&#22312;&#21363;&#26102;&#30340;&#32452;&#21512;&#37324;&#32467;&#26524;&#65292;&#29992;<span class="RktSym"><span class="badlink"><span class="RktValLink">let</span></span></span>&#32465;&#23450;&#24182;&#34987;&#19968;&#20010;&#21518;&#26469;&#30340;&#20855;&#20307;flonum&#25805;&#20316;&#25509;&#21463;&#30340;flonum&#20855;&#20307;&#32467;&#26524;&#22312;&#20020;&#26102;&#23384;&#20648;&#20043;&#20013;&#34987;&#24320;&#31665;&#12290;&#26368;&#21518;&#65292;&#32534;&#35793;&#22120;&#21487;&#20197;&#26816;&#27979;&#19968;&#20123;flonum&#20540;&#24490;&#29615;&#25910;&#38598;&#22120;&#24182;&#36991;&#20813;&#25910;&#38598;&#22120;&#30340;&#35013;&#31665;&#12290;&#23383;&#33410;&#30721;&#21453;&#32534;&#35793;&#22120;&#65288;&#35265;<font class="badlink">(part ("(lib scribblings/raco/raco.scrbl)" "decompile"))</font>&#65289;&#35808;&#37322;&#32452;&#21512;&#65292;&#37027;&#37324;JIT&#21487;&#20197;&#36991;&#20813;&#29992;<span class="RktSym">#%flonum</span>&#12289;<span class="RktSym">#%as-flonum</span>&#21644;<span class="RktSym">#%from-flonum</span>&#35013;&#31665;&#12290;</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>&#23616;&#37096;&#32465;&#23450;&#21644;&#25910;&#38598;&#22120;&#30340;&#25286;&#31665;&#19981;&#34987;PowerPC&#30340;JIT&#25903;&#25345;&#12290;</p></blockquote></blockquote></blockquote><p><font class="badlink"><span class="RktModLink"><span class="RktSym">racket/unsafe/ops</span></span></font>&#24211;&#25552;&#20379;&#26410;&#32463;&#26816;&#26597;&#30340;fixnum&#21644;flonum&#20855;&#20307;&#25805;&#20316;&#12290;&#26410;&#32463;&#26816;&#26597;&#30340;&#30340;flonum&#20855;&#20307;&#25805;&#20316;&#20801;&#35768;&#25286;&#31665;&#65292;&#24182;&#19988;&#26377;&#26102;&#23427;&#20204;&#20801;&#35768;&#32534;&#35793;&#22120;&#37325;&#25490;&#34920;&#36798;&#24335;&#26469;&#25552;&#39640;&#24615;&#33021;&#12290;&#20063;&#21442;&#35265;<a href="#%28part._unchecked-unsafe%29" data-pltdoc="x">&#26410;&#26816;&#26597;&#30340;&#12289;&#19981;&#23433;&#20840;&#30340;&#25805;&#20316;</a>&#65292;&#29305;&#21035;&#26159;&#20851;&#20110;&#19981;&#23433;&#20840;&#30340;&#35686;&#21578;&#12290;</p><h4>19.8<tt>&nbsp;</tt><a name="(part._unchecked-unsafe)"></a>&#26410;&#26816;&#26597;&#30340;&#12289;&#19981;&#23433;&#20840;&#30340;&#25805;&#20316;</h4><p><font class="badlink"><span class="RktModLink"><span class="RktSym">racket/unsafe/ops</span></span></font>&#24211;&#25552;&#20379;&#31867;&#20284;&#20110;<font class="badlink"><span class="RktModLink"><span class="RktSym">racket/base</span></span></font>&#37324;&#30340;&#20854;&#23427;&#20989;&#25968;&#30340;&#20989;&#25968;&#65292;&#20294;&#23427;&#20204;&#20551;&#35774;&#65288;&#32780;&#19981;&#26159;&#26816;&#26597;&#65289;&#25552;&#20379;&#30340;&#21442;&#25968;&#26159;&#27491;&#30830;&#30340;&#31867;&#22411;&#12290;&#20363;&#22914;&#65292;<span class="RktSym"><span class="badlink"><span class="RktValLink">unsafe-vector-ref</span></span></span>&#20174;&#19968;&#20010;&#21521;&#37327;&#20013;&#35775;&#38382;&#19968;&#20010;&#20803;&#32032;&#65292;&#32780;&#19981;&#26816;&#26597;&#23427;&#30340;&#31532;&#19968;&#20010;&#21442;&#25968;&#23454;&#38469;&#19978;&#26159;&#19968;&#20010;&#21521;&#37327;&#65292;&#32780;&#19981;&#26816;&#26597;&#32473;&#23450;&#30340;&#32034;&#24341;&#26159;&#21542;&#22788;&#20110;&#30028;&#38480;&#20043;&#20869;&#12290;&#23545;&#20110;&#20351;&#29992;&#36825;&#20123;&#20989;&#25968;&#30340;&#32039;&#24490;&#29615;&#65292;&#36991;&#20813;&#26816;&#26597;&#26377;&#26102;&#21487;&#20197;&#21152;&#24555;&#35745;&#31639;&#36895;&#24230;&#65292;&#23613;&#31649;&#19981;&#21516;&#30340;&#26410;&#26816;&#26597;&#20989;&#25968;&#21644;&#19981;&#21516;&#19978;&#19979;&#25991;&#30340;&#22909;&#22788;&#26377;&#25152;&#19981;&#21516;&#12290;</p><p>&#35201;&#23567;&#24515;&#30340;&#26159;&#65292;&#22914;&#21516;&#22312;&#24211;&#21644;&#20989;&#25968;&#21517;&#24314;&#35758;&#20013;&#30340;&#8220;&#19981;&#23433;&#20840;&#8221;&#65292;&#28389;&#29992;<font class="badlink"><span class="RktModLink"><span class="RktSym">racket/unsafe/ops</span></span></font>&#23548;&#20986;&#20250;&#23548;&#33268;&#23849;&#28291;&#25110;&#20869;&#23384;&#25439;&#22351;&#12290;</p><h4>19.9<tt>&nbsp;</tt><a name="(part._ffi-pointer-access)"></a>&#22806;&#26469;&#30340;&#25351;&#38024;</h4><p><font class="badlink"><span class="RktModLink"><span class="RktSym">ffi/unsafe</span></span></font>&#24211;&#25552;&#20379;&#38750;&#23433;&#20840;&#35835;&#20889;&#20219;&#24847;&#25351;&#38024;&#20540;&#30340;&#20989;&#25968;&#12290;JIT&#25215;&#35748;<span class="RktSym"><span class="badlink"><span class="RktValLink">ptr-ref</span></span></span>&#21644;<span class="RktSym"><span class="badlink"><span class="RktValLink">ptr-set!</span></span></span>&#30340;&#20351;&#29992;&#20854;&#22312;&#31532;&#20108;&#20010;&#21442;&#25968;&#26159;&#19968;&#20010;&#23545;&#19979;&#38754;&#30340;&#19968;&#20010;&#20869;&#32622;C&#31867;&#22411;&#30340;&#30452;&#25509;&#24341;&#29992;&#65306;<span class="RktSym"><span class="badlink"><span class="RktValLink">_int8</span></span></span>&#12289;<span class="RktSym"><span class="badlink"><span class="RktValLink">_int16</span></span></span>&#12289;<span class="RktSym"><span class="badlink"><span class="RktValLink">_int32</span></span></span>&#12289;<span class="RktSym"><span class="badlink"><span class="RktValLink">_int64</span></span></span>&#12289;<span class="RktSym"><span class="badlink"><span class="RktValLink">_double</span></span></span>&#12289;<span class="RktSym"><span class="badlink"><span class="RktValLink">_float</span></span></span>&#21644;<span class="RktSym"><span class="badlink"><span class="RktValLink">_pointer</span></span></span>&#12290;&#28982;&#21518;&#65292;&#65292;&#28982;&#21518;&#22312;&#29983;&#25104;&#30340;&#20195;&#30721;&#20013;&#25191;&#34892;&#25351;&#38024;&#35835;&#20889;&#25805;&#20316;&#12290;</p><p>&#23383;&#33410;&#30721;&#32534;&#35793;&#22120;&#20250;&#20248;&#21270;&#28041;&#21450;&#25972;&#25968;&#30340;&#32553;&#20889;&#30340;&#24341;&#29992;&#65292;&#20687;<span class="RktSym"><span class="badlink"><span class="RktValLink">_int</span></span></span>&#23545;C&#31867;&#22411;&#20687;<span class="RktSym"><span class="badlink"><span class="RktValLink">_int32</span></span></span>&#8212;&#8212;&#20854;&#34920;&#29616;&#22823;&#23567;&#26159;&#38745;&#24577;&#30340;&#36328;&#24179;&#21488;&#8212;&#8212;&#25152;&#20197;JIT&#21487;&#20197;&#19987;&#38376;&#29992;&#37027;&#20123;C&#31867;&#22411;&#35775;&#38382;&#12290;C&#31867;&#22411;&#22914;<span class="RktSym"><span class="badlink"><span class="RktValLink">_long</span></span></span>&#25110;<span class="RktSym"><span class="badlink"><span class="RktValLink">_intptr</span></span></span>&#19981;&#26159;&#38745;&#24577;&#30340;&#36328;&#24179;&#21488;&#20351;&#29992;&#65292;&#25152;&#20197;&#23427;&#20204;&#30340;&#20351;&#29992;&#30446;&#21069;&#27809;&#26377;&#34987;JIT&#19987;&#38376;&#21270;&#12290;</p><p>&#25351;&#38024;&#20351;&#29992;<span class="RktSym"><span class="badlink"><span class="RktValLink">_float</span></span></span>&#25110;<span class="RktSym"><span class="badlink"><span class="RktValLink">_double</span></span></span>&#35835;&#21462;&#21644;&#20889;&#20837;&#30446;&#21069;&#27809;&#26377;&#21463;&#21040;&#25286;&#31665;&#30340;&#20248;&#21270;&#12290;</p><h4>19.10<tt>&nbsp;</tt><a name="(part._regexp-perf)"></a>&#27491;&#21017;&#34920;&#36798;&#24335;&#24615;&#33021;</h4><p>&#24403;&#19968;&#20010;&#23383;&#31526;&#20018;&#25110;&#23383;&#33410;&#23383;&#31526;&#20018;&#25552;&#20379;&#19968;&#20010;&#31867;&#20284;<span class="RktSym"><span class="badlink"><span class="RktValLink">regexp-match</span></span></span>&#30340;&#20989;&#25968;&#65292;&#28982;&#21518;&#36825;&#20010;&#23383;&#31526;&#20018;&#34987;&#20869;&#37096;&#32534;&#35793;&#25104;&#19968;&#20010;<a href="regexp.html#%28tech._regexp%29" class="techoutside" data-pltdoc="x"><span class="techinside">regexp</span></a>&#20540;&#12290;&#32780;&#26159;&#22810;&#27425;&#25552;&#20379;&#19968;&#20010;&#23383;&#31526;&#20018;&#25110;&#23383;&#33410;&#23383;&#31526;&#20018;&#20316;&#20026;&#19968;&#20010;&#21305;&#37197;&#30340;&#27169;&#24335;&#65292;&#32534;&#35793;&#36825;&#20010;&#27169;&#24335;&#19968;&#27425;&#25104;&#20026;&#19968;&#20010;&#20351;&#29992;<span class="RktSym"><span class="badlink"><span class="RktValLink">regexp</span></span></span>&#12289;<span class="RktSym"><span class="badlink"><span class="RktValLink">byte-regexp</span></span></span>&#12289;<span class="RktSym"><span class="badlink"><span class="RktValLink">pregexp</span></span></span>&#25110;<span class="RktSym"><span class="badlink"><span class="RktValLink">byte-pregexp</span></span></span>&#30340;<a href="regexp.html#%28tech._regexp%29" class="techoutside" data-pltdoc="x"><span class="techinside">regexp</span></a>&#20540;&#12290;&#22312;&#19968;&#20010;&#24120;&#37327;&#23383;&#31526;&#20018;&#25110;&#23383;&#33410;&#23383;&#31526;&#20018;&#30340;&#22320;&#26041;&#65292;&#20351;&#29992;<span class="RktInBG"><span class="hspace"></span><span class="RktIn">#rx</span><span class="hspace"></span></span>&#25110;<span class="RktInBG"><span class="hspace"></span><span class="RktIn">#px</span><span class="hspace"></span></span>&#21069;&#32512;&#20889;&#19968;&#20010;&#24120;&#25968;<a href="regexp.html#%28tech._regexp%29" class="techoutside" data-pltdoc="x"><span class="techinside">regexp</span></a>&#12290;</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">slow-matcher</span><span class="hspace">&nbsp;</span><span class="RktSym">str</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">regexp-match?</span></span></span><span class="hspace">&nbsp;</span><span class="RktVal">"[0-9]+"</span><span class="hspace">&nbsp;</span><span class="RktSym">str</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fast-matcher</span><span class="hspace">&nbsp;</span><span class="RktSym">str</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">regexp-match?</span></span></span><span class="hspace">&nbsp;</span><span class="RktVal">#rx"[0-9]+"</span><span class="hspace">&nbsp;</span><span class="RktSym">str</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-slow-matcher</span><span class="hspace">&nbsp;</span><span class="RktSym">pattern-str</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">lambda</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">str</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">regexp-match?</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">pattern-str</span><span class="hspace">&nbsp;</span><span class="RktSym">str</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-fast-matcher</span><span class="hspace">&nbsp;</span><span class="RktSym">pattern-str</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">pattern-rx</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">regexp</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">pattern-str</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">lambda</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">str</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">regexp-match?</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">pattern-rx</span><span class="hspace">&nbsp;</span><span class="RktSym">str</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><h4>19.11<tt>&nbsp;</tt><a name="(part._gc-perf)"></a>&#20869;&#23384;&#31649;&#29702;</h4><p>Racket&#30340;&#23454;&#29616;&#22312;&#20004;&#20010;&#21464;&#31181;&#26041;&#38754;&#26377;&#34920;&#29616;&#65306;<font class="badlink"><span class="techoutside"><span class="techinside">3m</span></span></font>&#21644;<a name="(tech._cgc)"></a><span style="font-style: italic">CGC</span>&#12290;<font class="badlink"><span class="techoutside"><span class="techinside">3m</span></span></font>&#21464;&#31181;&#20351;&#29992;&#20102;&#29616;&#20195;&#30340;<a name="(tech._generational._garbage._collector~ef~bc~88~e4~b8~80~e4~bb~a3~e5~9e~83~e5~9c~be~e6~94~b6~e9~9b~86~e5~99~a8~ef~bc~89)"></a><span style="font-style: italic">generational garbage collector&#65288;&#19968;&#20195;&#22403;&#22334;&#25910;&#38598;&#22120;&#65289;</span>&#65292;&#20351;&#24471;&#23545;&#30701;&#29983;&#23384;&#26399;&#23545;&#35937;&#30340;&#20998;&#37197;&#30456;&#23545;&#20415;&#23452;&#12290;<a href="#%28tech._cgc%29" class="techoutside" data-pltdoc="x"><span class="techinside">CGC</span></a>&#21464;&#31181;&#20351;&#29992;&#19968;&#20010;<a name="(tech._conservative._garbage._collector~ef~bc~88~e4~bf~9d~e5~ae~88~e7~9a~84~e5~9e~83~e5~9c~be~e6~94~b6~e9~9b~86~e5~99~a8~ef~bc~89)"></a><span style="font-style: italic">conservative garbage collector&#65288;&#20445;&#23432;&#30340;&#22403;&#22334;&#25910;&#38598;&#22120;&#65289;</span>&#20415;&#20110;&#20132;&#20114;&#30340;C&#20195;&#30721;&#22312;Racket&#20869;&#23384;&#31649;&#29702;&#30340;&#31934;&#24230;&#21644;&#36895;&#24230;&#19978;&#30340;&#24320;&#38144;&#12290;3m&#21464;&#20307;&#26159;&#26631;&#20934;&#30340;&#12290;</p><p>&#34429;&#28982;&#20869;&#23384;&#20998;&#37197;&#30456;&#24403;&#20415;&#23452;&#65292;&#20294;&#36991;&#20813;&#23436;&#20840;&#20998;&#37197;&#36890;&#24120;&#26356;&#24555;&#12290;&#26377;&#26102;&#21487;&#20197;&#36991;&#20813;&#20998;&#37197;&#30340;&#19968;&#20010;&#29305;&#27530;&#20301;&#32622;&#26159;&#22312;&#38381;&#21253;&#20013;&#65292;&#36825;&#26159;&#21253;&#21547;&#33258;&#30001;&#21464;&#37327;&#20989;&#25968;&#30340;&#36816;&#34892;&#26102;&#34920;&#31034;&#12290;&#20363;&#22914;,</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">let</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">40000000</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">prev-thunk</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">lambda</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">if</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">zero?</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">prev-thunk</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">sub1</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">lambda</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>&#22312;&#27599;&#20010;&#36845;&#20195;&#20013;&#20998;&#37197;&#19968;&#20010;&#38381;&#21253;&#65292;&#22240;&#20026;<span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">lambda</span></span></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktSym">n</span><span class="RktPn">)</span>&#26377;&#25928;&#22320;&#20445;&#23384;<span class="RktSym">n</span>&#12290;</p><p>&#32534;&#35793;&#22120;&#21487;&#20197;&#33258;&#21160;&#28165;&#38500;&#35768;&#22810;&#38381;&#21253;&#12290;&#20363;&#22914;&#65292;&#22312;</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">let</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">40000000</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">prev-val</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">let</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">prev-thunk</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">lambda</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">if</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">zero?</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">prev-val</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">sub1</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">prev-thunk</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>&#20013;&#27809;&#26377;&#38381;&#21253;&#34987;&#27704;&#36828;&#20998;&#37197;&#32473;<span class="RktSym">prev-thunk</span>&#65292;&#22240;&#20026;&#21482;&#26377;&#24212;&#29992;&#31243;&#24207;&#26159;&#21487;&#35265;&#30340;&#65292;&#25152;&#20197;&#23427;&#26159;&#20869;&#32852;&#30340;&#12290;&#21516;&#26679;&#65292;&#22312;</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">let</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">n-loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">400000</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">if</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">zero?</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">done</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">let</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">m-loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">m</span><span class="hspace">&nbsp;</span><span class="RktVal">100</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">if</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">zero?</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">m</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">n-loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">sub1</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">m-loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">sub1</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">m</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>&#20013;&#65292;&#37027;&#20040;<span class="RktSym"><span class="badlink"><span class="RktValLink">let</span></span></span>&#30340;&#25193;&#23637;&#34920;&#23454;&#29616;<span class="RktSym">m-loop</span>&#21253;&#21547;&#19968;&#20010;n&#19978;&#30340;&#38381;&#21253;&#65292;&#20294;&#32534;&#35793;&#22120;&#33258;&#21160;&#23558;&#38381;&#21253;&#36716;&#21464;&#20197;&#20256;&#36882;&#32473;&#33258;&#24049;&#30340;<span class="RktSym">n</span>&#32780;&#19981;&#26159;&#20316;&#20026;&#19968;&#20010;&#21442;&#25968;&#12290;</p><h4>19.12<tt>&nbsp;</tt><a name="(part._.Reachability._and._.Garbage._.Collection)"></a>&#21487;&#36798;&#24615;&#19982;&#22403;&#22334;&#25910;&#38598;</h4><p>In general, Racket re-uses the storage for a value when the
garbage collector can prove that the object is unreachable from
any other (reachable) value. Reachability is a low-level,
abstraction breaking concept (and thus one must understand many
details of the runtime system&rsquo;s implementation to accurate predicate
precisely when values are reachable from each other),
but generally speaking one value is reachable from a second one when
there is some operation to recover the original value from the second
one.</p><p>To help programmers understand when an object is no longer reachable and its
storage can be reused,
Racket provides <span class="RktSym"><span class="badlink"><span class="RktValLink">make-weak-box</span></span></span> and <span class="RktSym"><span class="badlink"><span class="RktValLink">weak-box-value</span></span></span>,
the creator and accessor for a one-record struct that the garbage
collector treats specially. An object inside a weak box does not count
as reachable, and so <span class="RktSym"><span class="badlink"><span class="RktValLink">weak-box-value</span></span></span> might return the object
inside the box, but it might also return <span class="RktVal">#f</span> to indicate
that the object was otherwise unreachable and garbage collected.
Note that unless a garbage collection actually occurs, the value will
remain inside the weak box, even if it is unreachable.</p><p><div class="SIntrapara">For example, consider this program:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="hspace">&nbsp;</span><font class="badlink"><span class="RktModLink"><span class="RktSym">racket</span></span></font></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">struct</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">fish</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">weight</span><span class="hspace">&nbsp;</span><span class="RktSym">color</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">#:transparent</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fish</span><span class="hspace">&nbsp;</span><span class="RktVal">7</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">blue</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">make-weak-box</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">printf</span></span></span><span class="hspace">&nbsp;</span><span class="RktVal">"b has ~s\n"</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">weak-box-value</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">collect-garbage</span></span></span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">printf</span></span></span><span class="hspace">&nbsp;</span><span class="RktVal">"b has ~s\n"</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">weak-box-value</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">It will print <span class="RktInBG"><span class="hspace"></span><span class="RktIn">b has #(struct:fish 7 blue)</span><span class="hspace"></span></span> twice because the
definition of <span class="RktSym">f</span> still holds onto the fish. If the program
were this, however:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="hspace">&nbsp;</span><font class="badlink"><span class="RktModLink"><span class="RktSym">racket</span></span></font></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">struct</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">fish</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">weight</span><span class="hspace">&nbsp;</span><span class="RktSym">color</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">#:transparent</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fish</span><span class="hspace">&nbsp;</span><span class="RktVal">7</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">blue</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">make-weak-box</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">printf</span></span></span><span class="hspace">&nbsp;</span><span class="RktVal">"b has ~s\n"</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">weak-box-value</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">set!</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">collect-garbage</span></span></span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">printf</span></span></span><span class="hspace">&nbsp;</span><span class="RktVal">"b has ~s\n"</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">weak-box-value</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">the second printout will be <span class="RktInBG"><span class="hspace"></span><span class="RktIn">b has #f</span><span class="hspace"></span></span> because
no reference to the fish exists (other than the one in the box).</div></p><p><div class="SIntrapara">As a first approximation, all values in Racket must be allocated and will
demonstrate behavior similar to the fish above.
There are a number of exceptions, however:
</div><div class="SIntrapara"><ul><li><p>Small integers (recognizable with <span class="RktSym"><span class="badlink"><span class="RktValLink">fixnum?</span></span></span>) are
always available without explicit
allocation. From the perspective of the garbage collector
and weak boxes, their storage is never reclaimed. (Due to
clever representation techniques, however, their storage
does not count towards the space that Racket uses.
That is, they are effectively free.)</p></li><li><p>Procedures where
the compiler can see all of their call sites may never be
allocated at all (as discussed above).
Similar optimizations may also eliminate
the allocation for other kinds of values.</p></li><li><p>Interned symbols are allocated only once (per place). A table inside
Racket tracks this allocation so a symbol may not become garbage
because that table holds onto it.</p></li><li><p>Reachability is only approximate with the <a href="#%28tech._cgc%29" class="techoutside" data-pltdoc="x"><span class="techinside">CGC</span></a> collector (i.e.,
a value may appear reachable to that collector when there is,
in fact, no way to reach it anymore.</p></li></ul></div></p><h4>19.13<tt>&nbsp;</tt><a name="(part._.Weak_.Boxes_and_.Testing)"></a>Weak Boxes and Testing</h4><p>One important use of weak boxes is in testing that some abstraction properly
releases storage for data it no longer needs, but there is a gotcha that
can easily cause such test cases to pass improperly.</p><p>Imagine you&rsquo;re designing a data structure that needs to
hold onto some value temporarily but then should clear a field or
somehow break a link to avoid referencing that value so it can be
collected. Weak boxes are a good way to test that your data structure
properly clears the value. This is, you might write a test case
that builds a value, extracts some other value from it
(that you hope becomes unreachable), puts the extracted value into a weak-box,
and then checks to see if the value disappears from the box.</p><p><div class="SIntrapara">This code is one attempt to follow that pattern, but it has a subtle bug:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="hspace">&nbsp;</span><font class="badlink"><span class="RktModLink"><span class="RktSym">racket</span></span></font></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">let*</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">fishes</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">list</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fish</span><span class="hspace">&nbsp;</span><span class="RktVal">8</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">red</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fish</span><span class="hspace">&nbsp;</span><span class="RktVal">7</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">blue</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">wb</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">make-weak-box</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">list-ref</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">fishes</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">collect-garbage</span></span></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">printf</span></span></span><span class="hspace">&nbsp;</span><span class="RktVal">"still there? ~s\n"</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">weak-box-value</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">wb</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Specifically, it will show that the weak box is empty, but not
because <span class="RktVar">fishes</span> no longer holds onto the value, but
because <span class="RktVar">fishes</span> itself is not reachable anymore!</div></p><p><div class="SIntrapara">Change the program to this one:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="hspace">&nbsp;</span><font class="badlink"><span class="RktModLink"><span class="RktSym">racket</span></span></font></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">let*</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">fishes</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">list</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fish</span><span class="hspace">&nbsp;</span><span class="RktVal">8</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">red</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fish</span><span class="hspace">&nbsp;</span><span class="RktVal">7</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">blue</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">wb</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">make-weak-box</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">list-ref</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">fishes</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">collect-garbage</span></span></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">printf</span></span></span><span class="hspace">&nbsp;</span><span class="RktVal">"still there? ~s\n"</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">weak-box-value</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">wb</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">printf</span></span></span><span class="hspace">&nbsp;</span><span class="RktVal">"fishes is ~s\n"</span><span class="hspace">&nbsp;</span><span class="RktSym">fishes</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">and now we see the expected result. The difference is that last
occurrence of the variable <span class="RktVar">fishes</span>. That constitutes
a reference to the list, ensuring that the list is not itself
garbage collected, and thus the red fish is not either.</div></p><h4>19.14<tt>&nbsp;</tt><a name="(part._.Reducing_.Garbage_.Collection_.Pauses)"></a>Reducing Garbage Collection Pauses</h4><p>By default, Racket&rsquo;s <font class="badlink"><span class="techoutside"><span class="techinside">generational garbage collector</span></span></font> creates
brief pauses for frequent <a name="(tech._minor._collection)"></a><span style="font-style: italic">minor collections</span>, which inspect
only the most recently allocated objects, and long pauses for infrequent
<a name="(tech._major._collection)"></a><span style="font-style: italic">major collections</span>, which re-inspect all memory.</p><p>For some applications, such as animations and games,
long pauses due to a major collection can interfere
unacceptably with a program&rsquo;s operation. To reduce major-collection
pauses, the Racket garbage collector supports <a name="(tech._incremental._garbage._collection)"></a><span style="font-style: italic">incremental
garbage-collection</span> mode. In incremental mode, minor collections
create longer (but still relatively short) pauses by performing extra
work toward the next major collection. If all goes well, most of a
major collection&rsquo;s work has been performed by minor collections the
time that a major collection is needed, so the major collection&rsquo;s
pause is as short as a minor collection&rsquo;s pause. Incremental mode
tends to run more slowly overall, but it can
provide much more consistent real-time behavior.</p><p>If the <span class="stt">PLT_INCREMENTAL_GC</span> environment variable is set
to a value that starts with <span class="RktInBG"><span class="hspace"></span><span class="RktIn">1</span><span class="hspace"></span></span>, <span class="RktInBG"><span class="hspace"></span><span class="RktIn">y</span><span class="hspace"></span></span>, or <span class="RktInBG"><span class="hspace"></span><span class="RktIn">Y</span><span class="hspace"></span></span>
when Racket starts, incremental mode is permanently enabled. Since
incremental mode is only useful for certain parts of some programs,
however, and since the need for incremental mode is a property of a
program rather than its environment, the preferred way to enable
incremental mode is with <span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">collect-garbage</span></span></span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">incremental</span><span class="RktPn">)</span>.</p><p>Calling <span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">collect-garbage</span></span></span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">incremental</span><span class="RktPn">)</span> does not perform an
immediate garbage collection, but instead requests that each minor
collection perform incremental work up to the next major collection.
The request expires with the next major collection. Make a call to
<span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">collect-garbage</span></span></span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">incremental</span><span class="RktPn">)</span> in any repeating task within
an application that needs to be responsive in real time. Force a
full collection with <span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">collect-garbage</span></span></span><span class="RktPn">)</span> just before an initial
<span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">collect-garbage</span></span></span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">incremental</span><span class="RktPn">)</span> to initiate incremental mode
from an optimal state.</p><p>To check whether incremental mode is use and how it affects pause
times, enable <span class="stt">debug</span>-level logging output for the
<span class="RktSym">GC</span> topic. For example,</p><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">racket -W "debuG@GC error" main.rkt</span></p><p>runs <span class="stt">"main.rkt"</span> with garbage-collection logging to stderr
(while preserving <span class="stt">error</span>-level logging for all topics). Minor
collections are reported by <span class="RktInBG"><span class="hspace"></span><span class="RktIn">min</span><span class="hspace"></span></span> lines, increment-mode minor
collection are reported with <span class="RktInBG"><span class="hspace"></span><span class="RktIn">mIn</span><span class="hspace"></span></span> lines, and major
collections are reported with <span class="RktInBG"><span class="hspace"></span><span class="RktIn">MAJ</span><span class="hspace"></span></span> lines.</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="concurrency.html" title="backward to &quot;18 并发与同步&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Racket指南&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="parallelism.html" title="forward to &quot;20 Parallelism&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>